########################################################################
#
# This script sends a request to Virustotal to obtain the Virustotal report for every 
# malware sample stored in disk, so that Virustotal would send back a 
# report in JSON format
#
# To do this, it uses the VirusTotal_API Master tool using an API Key provided by Virstotal
#
########################################################################

#!/bin/bash

LOG_FILE=/opt/temporary/virustotal.log
DELAY=1

for k in 01-Duqu_OK 11-MiniDuke_OK 16-Gauss_OK 02-BlackEnergy2.1_OK 07-Duqu2_OK 12-CozyDuke_OK 03-Turla_OK 08-Skywiper-A.Flame_OK  13-APT28-Sofacy_OK
04-Regin_OK 09-APT1_OK 14-EquationGroup_OK 05-Careto_Feb2014_OK 10-CosmicDuke_OK 15-DarkSeoul-OperationTroy_OK 15-DarkSeoul-OperationTroy_OK
do
   	for i in `ls $k/PE/*`
	do 
		md5=`md5sum $i| cut -d'_' -f2`
		python /home/luis/tools/VirusTotal_API_Tool-master/vt.py $md5 -pj
		python /home/luis/tools/VirusTotalApi-master/vt/vt.py -rai $md5 >> $md5.report
		sleep $DELAY
	done 
	mkdir $k/PE/pcap
	mkdir $k/PE/json
	mkdir $k/PE/reports
	
	mv *pcap $k/PE/pcap
	mv *json $k/PE/json
	mv *report $k/PE/reports
done
