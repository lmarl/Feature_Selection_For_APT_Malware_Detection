########################################################################
#
# This script sends a request to Virustotal to obtain the Virustotal report for every 
# malware sample stored in disk, so that Virustotal would send back a 
# report in JSON format
#
# To do this, it uses the VirusTotal_API Master tool using an API Key provided by Virstotal
#
########################################################################

#!/bin/bash

LOG_FILE=/opt/temporary/virustotal.log
DELAY=1

for k in 0 1 2 3 4 5 6 7 8 9 A B C D E F
do
	for i in `ls $k/PE/Vir*`
	do 
		md5=`echo $i| cut -d'_' -f2`
		python /home/luis/tools/VirusTotal_API_Tool-master/vt.py $md5 -pj
		python /home/luis/tools/VirusTotalApi-master/vt/vt.py -rai $md5 >> $md5.report
		sleep $DELAY
	done 
	mkdir $k/PE/pcap
	mkdir $k/PE/json
	mkdir $k/PE/reports
	mv *pcap $k/PE/pcap
	mv *json $k/PE/json
	mv *report $k/PE/reports
done
