########################################################
# Este script coge los directorios de nuevos APTs, Crea los subdirectorios peframe y reports, obtiene su MD5
#y obtiene los anÃ¡lisis dinamico (mediante curl.sh) y estattico (mediante peframe)
##########################################

#!/bin/bash

#ESTADO:
# - Todos los peframe obtenidos
# - Todos los reports obtenidos
#Faltan estos:
#cat: APT10/reports/75500bb4143a052795ec7d2e61ac3261.report: No existe el archivo o el directorio
#cat: APT10/reports/fc26ad639598a92546af2daa6f6a7afd.report: No existe el archivo o el directorio
#cat: APT10/reports/ac725400d9a5fe832dd40a1afb2951f8.report: No existe el archivo o el directorio
#cat: APT10/reports/ac0ff4bad83350b7dde27af8728a469f.report: No existe el archivo o el directorio
#cat: APT10/reports/7af04a468de09c519681dcb0bd77030b.report: No existe el archivo o el directorio
#cat: APT10/reports/45f5b2404eefe7672534bcd13466987d.report: No existe el archivo o el directorio
#cat: APT10/reports/e85005524e8e6a8612c9d0899bb952d6.report: No existe el archivo o el directorio
#cat: APT10/reports/5f3b25e36f6c6637eb08dcca1c3a8ed6.report: No existe el archivo o el directorio
#cat: APT10/reports/9ee006601c5ee9f6f1992ec38fed63f6.report: No existe el archivo o el directorio
#cat: APT10/reports/f0be554b1d9b394bc2a90322ca944fce.report: No existe el archivo o el directorio
#cat: APT10/reports/d81b91cd4c6f42eb7049109cb42461ed.report: No existe el archivo o el directorio
#cat: APT10/reports/c1cb28327d3364768d1c1e4ce0d9bc07.report: No existe el archivo o el directorio
#cat: APT10/reports/9fb73e749107447fccd5bb48627fd6a9.report: No existe el archivo o el directorio
#cat: APT10/reports/c7f6e98e4539bd127573cd5934256c91.report: No existe el archivo o el directorio
#cat: APT10/reports/c0c8dcc9dad39da8278bf8956e30a3fc.report: No existe el archivo o el directorio
#cat: APT10/reports/a1d0f8895052b60c4d2860556494f233.report: No existe el archivo o el directorio
#cat: APT10/reports/95da3987c6ebd2646e90b7c2a42c19a7.report: No existe el archivo o el directorio
#cat: APT10/reports/d4398f6f7ba070b6cdee7204f6862bd9.report: No existe el archivo o el directorio
#cat: APT10/reports/f6a79b54c6351c32fe35cda9a78b607f.report: No existe el archivo o el directorio
#cat: APT10/reports/e1663b6462115ba929b05bb75a61ed5f.report: No existe el archivo o el directorio
#cat: APT10/reports/e84b87db6ae7c34fc7e6bc2f0bef4ae4.report: No existe el archivo o el directorio
#cat: APT10/reports/684888079aaf7ed25e725b55a3695062.report: No existe el archivo o el directorio
#cat: APT10/reports/b18a316b2ce6e099fe7fbf69283cbc5e.report: No existe el archivo o el directorio
#cat: APT10/reports/7bee1d0709169e07db6182e65dc50b60.report: No existe el archivo o el directorio
#cat: APT10/reports/583ab1678588b754899b9d2c58f20aa2.report: No existe el archivo o el directorio
#cat: APT10/reports/82f926009c06dfa452714608da21cb77.report: No existe el archivo o el directorio
#cat: APT10/reports/8ece7de82e1bdd4659a122c06ea9533e.report: No existe el archivo o el directorio
#cat: APT10/reports/9af4c1e5bb81bf2df607653fcc25915a.report: No existe el archivo o el directorio
#cat: APT10/reports/e1fbf8d74b622fde3cf765a3a51ca39f.report: No existe el archivo o el directorio
#cat: APT10/reports/8d6b6e023b4221bae8ed37bb18407516.report: No existe el archivo o el directorio
#cat: APT10/reports/bd64660692b84e2b6fcb25d02cecbbcb.report: No existe el archivo o el directorio
#cat: APT10/reports/dc6ffd15d88f15f129f6f00f4fb82a0a.report: No existe el archivo o el directorio
#cat: APT10/reports/d7dc970923cc80be272aaf6bd1a59fe7.report: No existe el archivo o el directorio
#cat: APT10/reports/9a014c33f9a9958ffbcf99d2a71d52fe.report: No existe el archivo o el directorio
#cat: APT10/reports/a2768b46a48c72e6f183c99333c14ff6.report: No existe el archivo o el directorio
#cat: APT10/reports/686bb59ea637fb3af214c8c21761cda8.report: No existe el archivo o el directorio
#cat: APT10/reports/93a4328e1e347447044146b53972cd37.report: No existe el archivo o el directorio
#cat: APT10/reports/f86c912661dbda535cbab464e79e26be.report: No existe el archivo o el directorio
#cat: APT10/reports/b3139b26a2dabb9b6e728884d8fa8b33.report: No existe el archivo o el directorio
#cat: APT10/reports/c1e5c46e4ef284f2922bb458c9ba3ce2.report: No existe el archivo o el directorio
#cat: APT10/reports/59a3ff3496740ceea97ff70a980bc3ae.report: No existe el archivo o el directorio
#cat: APT10/reports/83448fc10f297a6968aeda7c02b09051.report: No existe el archivo o el directorio
#cat: APT10/reports/53c8096033db54e5ec3d5eb9ac080fc4.report: No existe el archivo o el directorio
#cat: APT10/reports/72f50a28656fa65b6d770af89ed82d69.report: No existe el archivo o el directorio
#cat: APT10/reports/c578b8db3869d92482fc77eeedf41eb0.report: No existe el archivo o el directorio
#cat: APT10/reports/d316848ce47c098ccfe72aa7311aaffa.report: No existe el archivo o el directorio
#cat: APT10/reports/79e5a1d9adad4d64c8f5be2eb8345605.report: No existe el archivo o el directorio
#cat: APT10/reports/a1942d1cc7552387393b91a14c9a3d73.report: No existe el archivo o el directorio
#cat: APT10/reports/f03f70d331c6564aec8931f481949188.report: No existe el archivo o el directorio
#cat: APT10/reports/e0ab70ff814592a18864eb05a516a711.report: No existe el archivo o el directorio
#cat: APT10/reports/726788726dfb19231c6fc9c83ee2f392.report: No existe el archivo o el directorio
#cat: APT10/reports/d1adc4f3a766b1bc55e3508c380c6d3d.report: No existe el archivo o el directorio
#cat: APT10/reports/d9a958d55d457d745998ee70cf025cb9.report: No existe el archivo o el directorio
#cat: APT10/reports/429f5048462fd037e3ad7f8a211004c6.report: No existe el archivo o el directorio
#cat: APT10/reports/55b8690c0aae4e500e645d5f49ce5a13.report: No existe el archivo o el directorio
#cat: APT10/reports/c870ce1cbc120f74059e5f1bb1f76040.report: No existe el archivo o el directorio
#cat: APT10/reports/bd1ae82185d3eb0a8c8c615e710240ac.report: No existe el archivo o el directorio
#cat: APT10/reports/d1bab4a30f2889ad392d17573302f097.report: No existe el archivo o el directorio
#cat: APT10/reports/ae3c3741c6fc6fe9bafae5fd352e58f7.report: No existe el archivo o el directorio
#cat: APT10/reports/b4bea824c539785dedb83c8599c90255.report: No existe el archivo o el directorio
#cat: APT10/reports/841dfe3eaafe68cc0b989fbf55a34c9c.report: No existe el archivo o el directorio
#cat: APT10/reports/ca507b0dd178471e9cadf4ca313a67e3.report: No existe el archivo o el directorio
#cat: APT10/reports/a32468828c12657497cddf57190f5700.report: No existe el archivo o el directorio
#cat: APT10/reports/d69598758998cf5f677be9312b807938.report: No existe el archivo o el directorio
#cat: APT10/reports/35947b085e4593ccf38a5eb26ca4d4cf.report: No existe el archivo o el directorio
#cat: APT10/reports/d84851ad131424f04fbffc3bbac03bff.report: No existe el archivo o el directorio


for i in OlympicDestroyer DPRK GamaredonGroup GreenbugAPT Dridex GandCrab  GreyEnergyAPT APT34,Iranian DarkHydrus DustSquad GazaAPTGroup VoodooBearAPT APT37,NK,Reaper  DarkTequila APTC23 GoziGroup APT19 APT10 APT32 GorgonGroup
do
	mkdir $i/peframe
	mkdir $i/reports
	for j in `ls $i`
	do
		md5=`md5sum $i/$j | awk '{ print $1 }'`

		#Obtain analisis from virustotal
		./0_curl.sh $md5  | sed 's/: null/: \"null\"/g' > $i/reports/$md5.report

		#Static analysis with peframe
		peframe $i/$j > $i/peframe/$md5.peframe
	done
done
