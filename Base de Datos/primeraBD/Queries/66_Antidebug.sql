ALTER TABLE CSV ADD COLUMN ANTIDEBUG-BINARY VARCHAR(24);

create temporary table temp2 
       SELECT MD5, GROUP_CONCAT(function SEPARATOR ',') functions 
       FROM PEFRAME_AntiDebug group by MD5;

alter table temp2 add binar varchar(24);

--De esta tabla temp2 se detectaron las APIs antidebug m√°s utilizadas, que fueron las siguientes 23:

--FindWindowExA,Process32First,Process32Next,FindWindowA,TerminateProcess,UnhandledExceptionFilter,GetWindowThreadProcessId,OutputDebugStringA,ZwQueryInformationFile,ZwQueryInformationThread,%IsDebuggerPresent,OutputDebugStringW,FindWindowExW,FindWindowW,Process32FirstW,Process32NextW,ZwQueryInformationToken,ZwQueryInformationProcess,ZwQueryInformationPort,CheckRemoteDebuggerPresent,OutputDebugStringI,ZwQueryInformationJobObject,ZwQueryInformationAtom

--A partir de este listado se crea la siguiente query para crear un binary:

create table PEFRAME_AntiDebug_BINARY select MD5, concat ('', 
CASE WHEN functions LIKE '%FindWindowExA%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%Process32First%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%Process32Next%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%FindWindowA%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%TerminateProcess%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%UnhandledExceptionFilter%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%GetWindowThreadProcessId%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%OutputDebugStringA%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%ZwQueryInformationFile%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%ZwQueryInformationThread%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%IsDebuggerPresent%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%OutputDebugStringW%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%FindWindowExW%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%FindWindowW%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%Process32FirstW%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%Process32NextW%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%ZwQueryInformationToken%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%ZwQueryInformationProcess%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%ZwQueryInformationPort%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%CheckRemoteDebuggerPresent%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%OutputDebugStringI%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%ZwQueryInformationJobObject%' THEN '1' ELSE '0' END, 
CASE WHEN functions LIKE '%ZwQueryInformationAtom%' THEN '1' ELSE '0' END ) binario from temp2;

UPDATE CSV SET ANTIDEBUG-BINARY=(SELECT BINARIO FROM temp2 WHERE temp2.MD5=CSV.MD5);
